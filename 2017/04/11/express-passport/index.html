<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>使用 Passport 實作 Nodejs 應用程式驗證機制 | DEVLOG of andyyou</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。
在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - passport。passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Passport 實作 Nodejs 應用程式驗證機制">
<meta property="og:url" content="//andyyou.github.io/2017/04/11/express-passport/index.html">
<meta property="og:site_name" content="DEVLOG of andyyou">
<meta property="og:description" content="為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。
在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - passport。passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於">
<meta property="og:image" content="http://imgur.com/a/KQO2K.png">
<meta property="og:image" content="https://cms-assets.tutsplus.com/uploads/users/388/posts/21619/image/Bird_Eye_View_of_PassportJS_App.png">
<meta property="og:updated_time" content="2017-04-11T02:40:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用 Passport 實作 Nodejs 應用程式驗證機制">
<meta name="twitter:description" content="為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。
在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - passport。passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於">
<meta name="twitter:image" content="http://imgur.com/a/KQO2K.png">
    

    

    
        <link rel="icon" href="/images/favicon.png" />
    

    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/open-sans/styles.css">
    <link rel="stylesheet" href="/lib/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/lib/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/lib/lightgallery/css/lightgallery.min.css">
    
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-39208536-1', 'auto');
ga('send', 'pageview');

</script>
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">DEVLOG of andyyou</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜尋" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: 'Pages',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜尋" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466" />
            <h2 id="name">andyyou</h2>
            <h3 id="title">Web Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Taipei, Taiwan</span>
            <a id="follow" target="_blank" href="https://github.com/andyyou">關注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                146
                <span>文章</span>
            </div>
            <div class="article-info-block">
                57
                <span>標籤</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/andyyou" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.linkedin.com/pub/zongyan-you/2a/493/16" target="_blank" title="linkedin" class=tooltip>
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-express-passport" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            使用 Passport 實作 Nodejs 應用程式驗證機制
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/04/11/express-passport/">
            <time datetime="2017-04-11T01:30:50.000Z" itemprop="datePublished">2017-04-11</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/javascript-express-passport/">javascript express passport</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>為應用程式實作穩固的驗證機制一直以來都是令人害怕的工作，當然在 Nodejs 的世界中也不例外。</p>
<p>在這篇文章，我們將要從零開始開發一個 Nodejs 的應用程式搭配一套熱門的驗證 Middleware - <a href="http://passportjs.org/" target="_blank" rel="external">passport</a>。<br>passport 本身單純只關注驗證相關的部分，在官方文件中它這麼描述：這是一套簡單，可無縫整合於 Node 的 Middlewre。理解它本質是 Middleware 有助於後續的應用。</p>
<a id="more"></a>
<p>透過 Middleware 的機制，passport 將驗證所需的工作抽離以達到關注點分離的特點。同時這讓 passport 可以簡單的設定任何基於 express 的應用程式，就像我們設定其他 express middleware 一樣，例如 <a href="https://github.com/expressjs/morgan" target="_blank" rel="external">logging</a>，<a href="https://github.com/expressjs/body-parser" target="_blank" rel="external">body-parser</a>，<a href="https://github.com/expressjs/cookie-parser" target="_blank" rel="external">cookie-parser</a> 等等。</p>
<p>這裡我們假設您對於 Nodejs 和 express 有些基本的認識，我們將專注在驗證機制的部分。</p>
<h1 id="驗證機制-策略-Authentication-Strategies"><a href="#驗證機制-策略-Authentication-Strategies" class="headerlink" title="驗證機制/策略 (Authentication Strategies)"></a>驗證機制/策略 (Authentication Strategies)</h1><p>passport 提供了 300 多種驗證機制讓我們選擇。我們可以使用本地端或遠端的資料庫來驗證用戶身分又或者使用 OAuth 來完成單一登入 (SSO) 的功能例如 Facebook，Twitter，Google 等等。我們可以從<a href="https://github.com/expressjs/cookie-parser" target="_blank" rel="external">驗證機制列表</a>中選擇 passport 有支援的 Node 模組。</p>
<p>小結來說：passport 是一個 Middleware，負責處理身分驗證，其將 <code>驗證邏輯</code> 抽離並稱其為 <code>驗證策略 Stratety</code> 例如：使用本地端的資料庫驗證是一種策略，Facebook 登入也是一種，我們可以依據需求使用。</p>
<p>先別擔心，我們只需要安裝我們需要的東西即可。每個驗證策略模組都是獨立的，當我們安裝 passport 時，預設<code>不會</code>幫我們安裝任何一種。</p>
<p>在這篇文章我們將會使用最常見的方式 - 本地端驗證策略搭配我們存在本地端 MongoDB 資料庫的帳號。為了要使用本地端驗證機制，我們需要安裝 <code>passport-local</code>。</p>
<p>OK，到這邊我們理解了， <code>passport</code> 需要搭配不同的<code>驗證策略</code>，這裡我們使用 <code>passport-local</code>。</p>
<p>在開始之前，我們還需要一個 express 應用程式。讓我們打開終端機，建立一個 express 應用程式。這個應用程式會有包含登入，註冊，首頁的功能。注意，我們將要使用 express 4 來實作。</p>
<h1 id="設定應用程式"><a href="#設定應用程式" class="headerlink" title="設定應用程式"></a>設定應用程式</h1><p>如果您還沒安裝 express 產生器請先跟著<a href="https://expressjs.com/en/starter/generator.html" target="_blank" rel="external">官方文件</a>安裝。然後我們執行下面的指令建立專案。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ express express-mongodb-passport</div></pre></td></tr></table></figure>
<p><img src="http://imgur.com/a/KQO2K.png" alt=""></p>
<p>為了讓事情單純，不被混淆。我們要移除一些預設 generator 產生的但我們不需要的東西 - 刪除 <code>routes/users.js</code> 和 <code>app.js</code> 中有使用 <code>routes/users.js</code> 部分的程式碼。</p>
<h1 id="安裝-passport-和相關模組"><a href="#安裝-passport-和相關模組" class="headerlink" title="安裝 passport 和相關模組"></a>安裝 passport 和相關模組</h1><p>在終端機上，切換到我們的專案目錄下安裝 <code>passport</code>，<code>passport-local</code> 和預設的模組。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm i</div><div class="line">$ npm i passport passport-local -S</div></pre></td></tr></table></figure>
<p>因為我們要把使用者帳號等資訊存在 MongoDB 中。為了方便，這邊我們會使用 <code>mongoose</code> 這個 ODM 函式庫來協助我們操作 MongoDB。</p>
<p>一樣讓我們來安裝。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i mongoose -S</div></pre></td></tr></table></figure>
<p>現在，我們已經安裝好相依的函式庫了，讓我們執行 <code>npm start</code> 來看看程式是否可以正常運作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm start</div></pre></td></tr></table></figure>
<p>啟動 Server 之後我們用瀏覽器查看 <code>http://localhost:3000</code> 應該要能看到 express 預設的首頁。</p>
<p>雖然畫面上除了簡單的文字，什麼都沒有。沒關係！我們會接著完成 <code>註冊</code>，<code>登入</code>並使用 passport 驗證已註冊的使用者。</p>
<h1 id="建立-mongoose-資料模型"><a href="#建立-mongoose-資料模型" class="headerlink" title="建立 mongoose 資料模型"></a>建立 mongoose 資料模型</h1><p>因為我們要使用 mongoose 來將使用者帳號資料等存在 MongoDB，要使用 ODM 第一步我們需要先定義資料模型。</p>
<p>在專案目錄下建立 <code>models/user.js</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</div><div class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</div><div class="line">  <span class="attr">username</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">passport</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">gender</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">firstname</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">lastname</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">address</span>: <span class="built_in">String</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'User'</span>, UserSchema);</div></pre></td></tr></table></figure>
<p>基本上我們建立的這個 mongoose 資料模型是讓我們簡化 CRUD 的操作，參考<a href="http://mongoosejs.com/docs/models.html" target="_blank" rel="external">文件</a>中的範例程式碼就能明白為什麼我們需要這麼做。</p>
<h1 id="設定-MongoDB"><a href="#設定-MongoDB" class="headerlink" title="設定 MongoDB"></a>設定 MongoDB</h1><p>如果您本機還沒安裝 MongoDB 請先遵循<a href="https://docs.mongodb.com/manual/installation/" target="_blank" rel="external">官方文件</a>進行安裝。又或者可以使用雲端服務 <a href="https://mongolab.com/welcome/" target="_blank" rel="external">MongoLab</a>。</p>
<p>在我們安裝完成 MongoDB 並啟動之後我們就可以使用 <code>mongodb://localhost:27017</code> 來連線。如果您是使用雲端服務您應該會取得一個連線字串像是 <code>mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@&lt;service.url.com&gt;:27017/&lt;dbName&gt;</code>。這個連線字串會決定我們操作的資料庫。</p>
<p>通常在專案中我們會將資料庫設定的部分獨立出來。在這裡我們建立一個 <code>db.js</code> 來負責資料庫相關的部分。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">connection</span>: <span class="string">'mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@&lt;service.url.com&gt;:27017/&lt;dbName&gt;'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果您跟我一樣是使用本機的 MongoDB ，請記得啟動您的 MongoDB 並且設定如下</p>
<blockquote>
<p>資料庫名稱即 <code>&lt;dbName&gt;</code> 的部分可以自行修改。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123;</div><div class="line">  connection: &apos;mongodb://localhost:27017/express-mongodb-passport-development&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>現在，我們已經完成前置作業，讓我們在 <code>app.js</code> 載人並使用 mongoose </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./db'</span>);</div><div class="line">mongoose.connect(config.connection);</div></pre></td></tr></table></figure>
<h1 id="設定-passport"><a href="#設定-passport" class="headerlink" title="設定 passport"></a>設定 passport</h1><p>passport 本身只提供驗證機制，其他過程中如果需要功能像是 session 則是交給其他 Middleware。這邊我們則使用 <code>express-session</code> 來處理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i express-session -S</div></pre></td></tr></table></figure>
<p>安裝完之後我們開始在 <code>app.js</code> 中設定 passport</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var passport = require('passport);</div><div class="line">var LocalStrategy = require('passport-local').Strategy</div><div class="line">var session = require('express-session);</div><div class="line"></div><div class="line">app.use(sesion(&#123; </div><div class="line">  secret: 'your secret key',</div><div class="line">  resave: false,</div><div class="line">  saveUninitialized: false</div><div class="line">&#125;));</div><div class="line">app.use(passport.initialize())</div><div class="line">app.use(passport.session())</div></pre></td></tr></table></figure>
<p>加上 <code>session</code> 的設定是因為我們希望用戶登入後的相關資料可以透過 session 被保留且一致，所以我們才安裝了 <code>express-session</code> 來幫我們處理這部分。<br><code>LocalStrategy</code> 並不強制使用 session，我們也可以透過參數來關閉，但如果沒有使用 session 每一次<code>登入後資料不會自動保留</code>需要自己處理。</p>
<blockquote>
<p>概念：passport 可以 <code>use</code> 多個策略，接著只要在對應的路由使用 <code>passport.authenticate(&#39;&lt;strategy-name&gt;&#39;)</code> 即可。</p>
</blockquote>
<h1 id="序列化與反序列化-User-物件"><a href="#序列化與反序列化-User-物件" class="headerlink" title="序列化與反序列化 User 物件"></a>序列化與反序列化 User 物件</h1><p>序列化指的是一個轉換資料格式的過程。為了支援登入的 session，passport 需要把從 session 取得的資料轉換成帳號資料即 User 的物件實例。<br>因此後續的 request 請求將不會重複包含使用者的認證資訊。為了完成這個功能，passport 提供了兩個方法 <code>serializeUser</code> 和 <code>deserializeUser</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">passport.serializeUser(<span class="function"><span class="keyword">function</span> (<span class="params">user, done</span>) </span>&#123;</div><div class="line">  done(<span class="literal">null</span>, user._id);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">passport.deserializeUser(<span class="function"><span class="keyword">function</span> (<span class="params">id, done</span>) </span>&#123;</div><div class="line">  User.findById(id, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</div><div class="line">    done(err, user);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>看完上面的程式碼，您應該理解了；passport 只把 <code>user._id</code> 存在 session，取回時在反序列化從資料庫找回 User 物件。</p>
<h1 id="使用-passport-驗證機制"><a href="#使用-passport-驗證機制" class="headerlink" title="使用 passport 驗證機制"></a>使用 passport 驗證機制</h1><h3 id="登入機制"><a href="#登入機制" class="headerlink" title="登入機制"></a>登入機制</h3><p>現在，我們終於要為登入和註冊行為定義 passport 的驗證機制。在<code>這個範例</code>中每個<code>驗證策略</code>或者說驗證邏輯比較通順，它們都是一個 passport 的 <code>Local Authentication Strategy</code> 物件，並可以使用 <code>passport.use()</code> 來套用。這裡我們要在加上一個函式庫 <code>connect-flash</code> 來協助我們處理呈現<code>動作結果的資訊</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">passport.use(<span class="string">'login'</span>, <span class="keyword">new</span> LocalStrategy(&#123;</div><div class="line">    <span class="attr">passReqToCallback</span>: <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">req, username, password, done</span>) </span>&#123;</div><div class="line">    User.findOne(&#123; <span class="attr">username</span>: username &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="keyword">return</span> done(err)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (!user) &#123;</div><div class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, req.flash(<span class="string">'info'</span>, <span class="string">'User not found.'</span>))</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (!isValidPassword(user, password)) &#123;</div><div class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, req.flash(<span class="string">'info'</span>, <span class="string">'Invalid password'</span>))</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">return</span> done(<span class="literal">null</span>, user)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">));</div></pre></td></tr></table></figure>
<p><code>passport.use()</code> 的第一個參數是驗證機制的名稱，稍後這可以用來識別到底是哪一套機制。第二個參數是我們想建立的<code>策略</code>類型，這邊我們使用 <code>LocalStrategy</code>。值得注意的是預設 LocalStrategy 會在 Middleware 傳遞的過程中查找 <code>req.body</code> 和 <code>req.query</code> 的 <code>username</code> 和 <code>password</code> 來取得用戶認證的資訊，但我們也可以使用其他參數名稱。</p>
<p>其中 <code>passReqToCallback</code> 參數設定讓我們可以在後續 callback 中存取 <code>req</code> 物件。如果沒有的話，那麼預設 callback 參數會如下：</p>
<blockquote>
<p>注意 <code>*</code> 註解</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> LocalStrategy(&#123;</div><div class="line">  <span class="comment">// 使用其他參數名稱取得用戶認證的資訊</span></div><div class="line">  usernameField: <span class="string">'email'</span>,</div><div class="line">  <span class="attr">passwordField</span>: <span class="string">'passwd'</span>,</div><div class="line">  <span class="comment">// 關閉 session</span></div><div class="line">  session: <span class="literal">false</span></div><div class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">username, password, done</span>) </span>&#123;</div><div class="line">  <span class="comment">//  * 沒有 passReqToCallback 的話，第一個參數就不是 req</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<blockquote>
<p>詳細 passport-local 的參數與用法請參考<a href="https://github.com/jaredhanson/passport-local" target="_blank" rel="external">說明</a></p>
</blockquote>
<p>取得用戶帳密之後就是驗證的邏輯我們會在 callback 參數中處理這件事。下一步，我們將使用 mongoose 取得帳號資訊來驗證帳號是否正確。<br>而在 LocalStrategy 的 callback 中最後一個參數 <code>done</code> 就是我們用來告訴 passport 模組登入結果的方法，假如登入失敗那麼第一個參數需要傳入錯誤訊息，第二個參數則是 <code>false</code>。登入成功的話，第一個參數則傳入 <code>null</code>，第二個則是任何為 <code>真</code> 的值，這個值會被加到 <code>req</code> 物件上以便我們後續使用。</p>
<p>接著，基於存放在 MongoDB 用戶資料的安全性考量，我們應該在儲存之前先將密碼加密。要完成這個需求我們需要使用加解密的函式庫。本文使用 <a href="https://www.npmjs.com/package/bcrypt-nodejs" target="_blank" rel="external">bcrypt-nodejs</a>，如果您有習慣的函式庫也可以使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i bcrypt-nodejs -S</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> isValidPassword = <span class="function"><span class="keyword">function</span> (<span class="params">user, password</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> bcrypt.compareSync(password, user.password)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>讓我們先來看看目前完成的 <code>app.js</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">var express = require('express');</div><div class="line">var path = require('path');</div><div class="line">var favicon = require('serve-favicon');</div><div class="line">var logger = require('morgan');</div><div class="line">var cookieParser = require('cookie-parser');</div><div class="line">var bodyParser = require('body-parser');</div><div class="line">var mongoose = require('mongoose');</div><div class="line">var passport = require('passport');</div><div class="line">var LocalStrategy = require('passport-local).Strategy;</div><div class="line">var session = require('express-session');</div><div class="line">var flash = require('connect-flash');</div><div class="line">var bcrypt = require('bcrypt-nodejs');</div><div class="line"></div><div class="line">// DB</div><div class="line">var config = require('./db');</div><div class="line">mongoose.connect(config.connection);</div><div class="line"></div><div class="line">passport.serializeUser(function (user, done) &#123;</div><div class="line">  done(null, user._id);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">passport.deserializeUser(function (id, done) &#123;</div><div class="line">  User.findById(id, function (err, user) &#123;</div><div class="line">    done(err, user);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">passport.use('login', new passport.LocalStrategy(&#123;</div><div class="line">    passReqToCallback: true</div><div class="line">  &#125;,</div><div class="line">  function (req, username, password, done) &#123;</div><div class="line">    User.findOne(&#123; username: username &#125;, function (err, user) &#123;</div><div class="line">      if (err) &#123;</div><div class="line">        return done(err)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (!user) &#123;</div><div class="line">        return done(null, false, req.flash('info', 'User not found.'))</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      var isValidPassword = function (user, password) &#123;</div><div class="line">        return bcrypt.compareSync(password, user.password)</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (!isValidPassword(user, password)) &#123;</div><div class="line">        return done(null, false, req.flash('info', 'Invalid password'))</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      return done(null, user)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">));</div><div class="line"></div><div class="line">var index = require('./routes/index');</div><div class="line"></div><div class="line">var app = express();</div><div class="line"></div><div class="line">// view engine setup</div><div class="line">app.set('views', path.join(__dirname, 'views'));</div><div class="line">app.set('view engine', 'jade');</div><div class="line"></div><div class="line">// uncomment after placing your favicon in /public</div><div class="line">//app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));</div><div class="line">app.use(logger('dev'));</div><div class="line">app.use(bodyParser.json());</div><div class="line">app.use(bodyParser.urlencoded(&#123; extended: false &#125;));</div><div class="line">app.use(cookieParser());</div><div class="line">app.use(express.static(path.join(__dirname, 'public')));</div><div class="line"></div><div class="line">app.use(session(&#123;</div><div class="line">  secret: 'your secret key',</div><div class="line">  resave: false,</div><div class="line">  saveUninitialized: false</div><div class="line">&#125;));</div><div class="line">app.use(passport.initialize());</div><div class="line">app.use(passport.session());</div><div class="line">app.use(flash());</div><div class="line"></div><div class="line">app.use('/', index);</div><div class="line"></div><div class="line">// catch 404 and forward to error handler</div><div class="line">app.use(function(req, res, next) &#123;</div><div class="line">  var err = new Error('Not Found');</div><div class="line">  err.status = 404;</div><div class="line">  next(err);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// error handler</div><div class="line">app.use(function(err, req, res, next) &#123;</div><div class="line">  // set locals, only providing error in development</div><div class="line">  res.locals.message = err.message;</div><div class="line">  res.locals.error = req.app.get('env') === 'development' ? err : &#123;&#125;;</div><div class="line"></div><div class="line">  // render the error page</div><div class="line">  res.status(err.status || 500);</div><div class="line">  res.render('error');</div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = app;</div></pre></td></tr></table></figure>
<h1 id="註冊機制"><a href="#註冊機制" class="headerlink" title="註冊機制"></a>註冊機制</h1><p>我們定義好登入部分的機制了，接著我們要定義下一個機制來處理新的使用者註冊帳號的部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">passport.use(<span class="string">'signup'</span>, <span class="keyword">new</span> LocalStrategy(&#123;</div><div class="line">  <span class="attr">passReqToCallback</span>: <span class="literal">true</span></div><div class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">req, username, password, done</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> findOrCreateUser = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    User.findOne(&#123; <span class="attr">username</span>: username &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="keyword">return</span> done(err);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (user) &#123;</div><div class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, req.flash(<span class="string">'info'</span>, <span class="string">'User already exists'</span>));</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">var</span> newUser = <span class="keyword">new</span> User();</div><div class="line">        newUser.username = username;</div><div class="line">        newUser.password = bcrypt.hashSync(password, bcrypt.genSaltSync(<span class="number">10</span>), <span class="literal">null</span>);</div><div class="line">        <span class="comment">// <span class="doctag">FIXME:</span> Test and change back to req.params.email</span></div><div class="line">        newUser.email = req.params(<span class="string">'email'</span>);</div><div class="line">        newUser.firstname = req.params(<span class="string">'firstname'</span>);</div><div class="line">        newUser.lastname = req.params(<span class="string">'lastname'</span>);</div><div class="line"></div><div class="line">        newUser.save(<span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span> (err) &#123;</div><div class="line">            <span class="keyword">throw</span> err;</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          <span class="keyword">return</span> done(<span class="literal">null</span>, user);</div><div class="line">        &#125;);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  process.nextTick(findOrCreateUser)</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<p>再一次我們使用 mongoose 來查詢看看是否有使用者已經註冊了一樣的 username 。如果沒有那麼我們就建立新的帳號，否則就返回一個錯誤訊息。</p>
<h1 id="建立路由"><a href="#建立路由" class="headerlink" title="建立路由"></a>建立路由</h1><p>讓我們先來看看這個程式的流程圖</p>
<p><img src="https://cms-assets.tutsplus.com/uploads/users/388/posts/21619/image/Bird_Eye_View_of_PassportJS_App.png" alt=""></p>
<p>完成登入和註冊的邏輯定義之後，我們要來撰寫路由。預設 express generator 將路由抽離成一個個模組，我們已經刪除了 <code>routes/users.js</code>。為了讓 <code>routes/idnex.js</code> 裡的路由能夠使用剛剛上面定義在 <code>app.js</code> 的 passport 物件，我們將改寫一下 <code>routes/index.js</code> 如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">passport</span>) </span>&#123;</div><div class="line">  router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">    res.render(<span class="string">'index'</span>, &#123; <span class="attr">message</span>: req.flash(<span class="string">'info'</span>) &#125;);</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  router.post(<span class="string">'/signin'</span>, passport.authenticate(<span class="string">'login'</span>, &#123;</div><div class="line">    <span class="attr">successRedirect</span>: <span class="string">'/home'</span>,</div><div class="line">    <span class="attr">failureRedirect</span>: <span class="string">'/'</span>,</div><div class="line">    <span class="attr">failureFlash</span>: <span class="literal">true</span></div><div class="line">  &#125;));</div><div class="line"></div><div class="line">  router.get(<span class="string">'/signup'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">    res.render(<span class="string">'signup'</span>, &#123; <span class="attr">message</span>: req.flash(<span class="string">'info'</span>) &#125;);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  router.post(<span class="string">'/signup'</span>, passport.authenticate(<span class="string">'signup'</span>, &#123;</div><div class="line">    <span class="attr">successRedirect</span>: <span class="string">'/home'</span>,</div><div class="line">    <span class="attr">failureRedirect</span>: <span class="string">'/signup'</span>,</div><div class="line">    <span class="attr">failureFlash</span>: <span class="literal">true</span></div><div class="line">  &#125;));</div><div class="line"></div><div class="line">  <span class="keyword">return</span> router;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面程式碼中最重要的部分就是：當 HTTP 發出 POST 的請求給 <code>login</code> 和 <code>signup</code> 時分別使用 <code>passport.authenticate()</code> 搭配對應的機制(login，signup)來處理。</p>
<p>注意到路由並不需要強制跟驗證機制模組的名稱一樣。</p>
<p>假如您還需要在驗證過程中加入其他處理，則可使用下面這種寫法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">router.post(<span class="string">'/signin'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  passport.authenticate(<span class="string">'login'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, user, info</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">      <span class="comment">// handle youself</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!user) &#123;</div><div class="line">      <span class="comment">// handle youself</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    req.login(user, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="keyword">return</span> next(err)</div><div class="line">      &#125;</div><div class="line">      req.flash(<span class="string">'info'</span>, <span class="string">'Sign in successfully'</span>)</div><div class="line">      <span class="keyword">return</span> res.redirect(<span class="string">'/'</span>)</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">  &#125;)(req, res, next)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h1 id="樣板"><a href="#樣板" class="headerlink" title="樣板"></a>樣板</h1><p>接著我們需要調整 views 的部分，我們總共需要註冊 <code>signup</code>，登入 <code>index</code>，後續需要登入驗證的頁面 <code>home</code>，以及調整我們的 <code>layout</code>。</p>
<ul>
<li><code>layout.jade</code> </li>
<li><code>index.jade</code> 登入頁</li>
<li><code>signup.jade</code> 註冊頁</li>
<li><code>home.jade</code> </li>
</ul>
<h3 id="layout-jade"><a href="#layout-jade" class="headerlink" title="layout.jade"></a><code>layout.jade</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">doctype html</div><div class="line">html</div><div class="line">  head</div><div class="line">    title= title</div><div class="line">    link(rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css&quot; integrity=&quot;sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ&quot; crossorigin=&quot;anonymous&quot;)</div><div class="line">    script(src=&quot;https://code.jquery.com/jquery-3.1.1.slim.min.js&quot; integrity=&quot;sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n&quot; crossorigin=&quot;anonymous&quot;)</div><div class="line">    script(src=&quot;https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js&quot; integrity=&quot;sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb&quot; crossorigin=&quot;anonymous&quot;)</div><div class="line">    script(src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js&quot; integrity=&quot;sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn&quot; crossorigin=&quot;anonymous&quot;)</div><div class="line">    link(rel=&apos;stylesheet&apos;, href=&apos;/stylesheets/style.css&apos;)</div><div class="line">  body</div><div class="line">    block content</div></pre></td></tr></table></figure>
<h3 id="index-jade"><a href="#index-jade" class="headerlink" title="index.jade"></a><code>index.jade</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">extends layout</div><div class="line"></div><div class="line">block content</div><div class="line">  div(class=&quot;container&quot;)</div><div class="line">    div(class=&quot;col-md-4 offset-md-4&quot;)</div><div class="line">      h1(class=&quot;text-center login-title&quot;) Sign In</div><div class="line">      div(class=&quot;card&quot;)</div><div class="line">        div(class=&quot;card-blcok&quot;)</div><div class="line">          form(action=&quot;/signin&quot; method=&quot;post&quot;)</div><div class="line">            input(type=&quot;text&quot; name=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Email&quot; required=&quot;true&quot; autofocus)</div><div class="line">            input(type=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required=&quot;true&quot;)</div><div class="line">            button(class=&quot;btn btn-primary btn-block&quot; type=&quot;submit&quot;) Sign In</div><div class="line">            span(class=&quot;clearfix&quot;)</div><div class="line">            if message.length</div><div class="line">              div(id=&quot;message&quot;)</div><div class="line">                  div(class=&quot;alert alert-danger text-center&quot;) #&#123;message&#125;</div></pre></td></tr></table></figure>
<h3 id="signup-jade"><a href="#signup-jade" class="headerlink" title="signup.jade"></a><code>signup.jade</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">extends layout</div><div class="line"></div><div class="line">block content</div><div class="line">  div(class=&quot;container&quot;)</div><div class="line">    div(class=&quot;col-md-4 offset-md-4&quot;)</div><div class="line">      h1(class=&quot;text-center login-title&quot;) Sign Up</div><div class="line">      div(class=&quot;card&quot;)</div><div class="line">        div(class=&quot;card-blcok&quot;)</div><div class="line">          form(action=&quot;/signup&quot; method=&quot;post&quot;)</div><div class="line">            input(type=&quot;text&quot; name=&quot;username&quot; class=&quot;form-control&quot; placeholder=&quot;Email&quot; required=&quot;true&quot; autofocus)</div><div class="line">            input(type=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;Password&quot; required=&quot;true&quot;)</div><div class="line">            button(class=&quot;btn btn-primary btn-block&quot; type=&quot;submit&quot;) Sign In</div><div class="line">            span(class=&quot;clearfix&quot;)</div><div class="line">            if message.length</div><div class="line">              div(id=&quot;message&quot;)</div><div class="line">                  div(class=&quot;alert alert-danger text-center&quot;) #&#123;message&#125;</div></pre></td></tr></table></figure>
<h3 id="home-jade"><a href="#home-jade" class="headerlink" title="home.jade"></a><code>home.jade</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">extends layout</div><div class="line"></div><div class="line">block content</div><div class="line">  div(class=&quot;container&quot;)</div><div class="line">    div(class=&quot;row&quot;)</div><div class="line">      div(class=&quot;col-12&quot;)</div><div class="line">        p(class=&quot;alert alert-primary&quot;) This is page will protected by passport.</div></pre></td></tr></table></figure>
<blockquote>
<p>基於商標因素 jade 樣板引擎已<a href="https://github.com/pugjs/pug/issues/2184" target="_blank" rel="external">改名為 pug</a>，雖然目前仍然支援但官方已警告 <code>deprecated</code> 建議更換為 pug。</p>
</blockquote>
<h1 id="登出"><a href="#登出" class="headerlink" title="登出"></a>登出</h1><p>passport 作爲一個 Middleware 它是具備加入屬性和方法到 <code>req</code> 和 <code>res</code> 物件的能力的。為了方便使用，它加了 <code>req.logout()</code> 這個方法讓我們可以將使用者存在 session 的資料作廢。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">router.get(<span class="string">'/signout'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  req.logout()</div><div class="line">  res.redirect(<span class="string">'/'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h1 id="驗證存取權限"><a href="#驗證存取權限" class="headerlink" title="驗證存取權限"></a>驗證存取權限</h1><p>passport 也賦予我們控制存取權限的能力，用來保護不能匿名存取的路由。從這個例子來說就是；當使用者沒有登入的情況下是無法存取 <code>http://localhost:3000/home</code> 我們會將他們導向登入或其他公開的頁面。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">function authenticated (req, res, next) &#123;</div><div class="line">  if (req.isAuthenticated()) &#123;</div><div class="line">    return next()</div><div class="line">  &#125;</div><div class="line">  res.redirect('/)</div><div class="line">&#125;</div><div class="line"></div><div class="line">router.get('/home', authenticated, function (req, res, next) &#123;</div><div class="line">  res.render('home', &#123; user: req.user &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>歸納來說，passport 這個 Middleware 會在整個 request 的過程中幫我們處理<code>驗證流程</code>，透過使用 <code>策略</code> 決定是否登入成功。在本例子中後續 Middleware 的 <code>req</code> 物件中我們就可以取得 <code>req.isAuthenticated()</code> 和 <code>req.user</code>。由於驗證是否登入可能會有很多路由需要使用，故上面我們將這部分抽成一個 Middleware function 方便後續使用。</p>
<p>另外關於 Node.js 世界的驗證套件 ， passport 並不是這個領域唯一的函式庫，還有像是 <code>everyauth</code> 等的函式庫。不過在社群支援度，模組化等部分的確相對優秀，這也是為什麼我們選擇 passport。</p>
<p>關於詳細的比較您可以參考<a href="http://stackoverflow.com/questions/11974947/everyauth-vs-passport-js" target="_blank" rel="external">everyauth vs passport</a>。</p>
<h1 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h1><ul>
<li><a href="https://code.tutsplus.com/tutorials/authenticating-nodejs-applications-with-passport--cms-21619" target="_blank" rel="external">Authenticating Node.js Applications With Passport</a></li>
<li><a href="https://nodejust.com/nodejs-passport-auth-tutorial/" target="_blank" rel="external">Node.js 身份認證：Passport 入門</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="//andyyou.github.io/2017/04/11/express-passport/" data-id="cj1cvfdlu00dwfvwxa83rnngo" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/2017/04/02/svg-coordinate-3/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">[譯] 理解 SVG 座標系統與 Transformation - 3 建立 viewpor</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">分類</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Cloud/">Cloud</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Fun/">Fun</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Program/">Program</a><span class="category-list-count">105</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/">System</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">15</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">歸檔</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">一月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">十一月 2011</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">標籤</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net-mvc/">.net mvc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RoR/">RoR</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">aws</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/">azure</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bot/">bot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bundler/">bundler</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cache/">cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/carrier-wave/">carrier wave</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudflare/">cloudflare</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compass/">compass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devise/">devise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/entity-framework/">entity framework</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facebook/">facebook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flux/">flux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/framework/">framework</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iisexpress/">iisexpress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/">ios</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">53</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript-express-passport/">javascript express passport</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jspm/">jspm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/">jwt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mechanism/">mechanism</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oocss/">oocss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/osx/">osx</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/package-manager/">package manager</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/">postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rack-server/">rack server</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry-pi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-native/">react native</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reactjs/">reactjs</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redux/">redux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sass/">sass</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/">selenium</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slim/">slim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg-javascript/">svg javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task-runner/">task runner</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/">xml</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">標籤雲</h3>
        <div class="widget tagcloud">
            <a href="/tags/net-mvc/" style="font-size: 10px;">.net mvc</a> <a href="/tags/RoR/" style="font-size: 17.27px;">RoR</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/aws/" style="font-size: 10px;">aws</a> <a href="/tags/azure/" style="font-size: 10.91px;">azure</a> <a href="/tags/bot/" style="font-size: 10px;">bot</a> <a href="/tags/bundler/" style="font-size: 10.91px;">bundler</a> <a href="/tags/cache/" style="font-size: 10px;">cache</a> <a href="/tags/carrier-wave/" style="font-size: 10.91px;">carrier wave</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/cloudflare/" style="font-size: 10px;">cloudflare</a> <a href="/tags/compass/" style="font-size: 10px;">compass</a> <a href="/tags/css/" style="font-size: 18.18px;">css</a> <a href="/tags/devise/" style="font-size: 10px;">devise</a> <a href="/tags/docker/" style="font-size: 10.91px;">docker</a> <a href="/tags/entity-framework/" style="font-size: 10px;">entity framework</a> <a href="/tags/es6/" style="font-size: 11.82px;">es6</a> <a href="/tags/facebook/" style="font-size: 10px;">facebook</a> <a href="/tags/flux/" style="font-size: 10px;">flux</a> <a href="/tags/framework/" style="font-size: 10.91px;">framework</a> <a href="/tags/grunt/" style="font-size: 12.73px;">grunt</a> <a href="/tags/gulp/" style="font-size: 11.82px;">gulp</a> <a href="/tags/heroku/" style="font-size: 11.82px;">heroku</a> <a href="/tags/html/" style="font-size: 10.91px;">html</a> <a href="/tags/iisexpress/" style="font-size: 10px;">iisexpress</a> <a href="/tags/ios/" style="font-size: 11.82px;">ios</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/javascript-express-passport/" style="font-size: 10px;">javascript express passport</a> <a href="/tags/jekyll/" style="font-size: 10.91px;">jekyll</a> <a href="/tags/jspm/" style="font-size: 10px;">jspm</a> <a href="/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mechanism/" style="font-size: 10px;">mechanism</a> <a href="/tags/mongodb/" style="font-size: 10.91px;">mongodb</a> <a href="/tags/nodejs/" style="font-size: 15.45px;">nodejs</a> <a href="/tags/oocss/" style="font-size: 10px;">oocss</a> <a href="/tags/osx/" style="font-size: 13.64px;">osx</a> <a href="/tags/package-manager/" style="font-size: 14.55px;">package manager</a> <a href="/tags/php/" style="font-size: 10.91px;">php</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql</a> <a href="/tags/rack-server/" style="font-size: 10px;">rack server</a> <a href="/tags/raspberry-pi/" style="font-size: 10px;">raspberry-pi</a> <a href="/tags/react-native/" style="font-size: 10px;">react native</a> <a href="/tags/reactjs/" style="font-size: 19.09px;">reactjs</a> <a href="/tags/redux/" style="font-size: 10px;">redux</a> <a href="/tags/ruby/" style="font-size: 16.36px;">ruby</a> <a href="/tags/sass/" style="font-size: 10.91px;">sass</a> <a href="/tags/selenium/" style="font-size: 10px;">selenium</a> <a href="/tags/slim/" style="font-size: 10px;">slim</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/svg-javascript/" style="font-size: 11.82px;">svg javascript</a> <a href="/tags/task-runner/" style="font-size: 11.82px;">task runner</a> <a href="/tags/vuejs/" style="font-size: 13.64px;">vuejs</a> <a href="/tags/webpack/" style="font-size: 12.73px;">webpack</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 andyyou(You,ZongYan)
        </div>
    </div>
</footer>

        

    
        <script src="/lib/lightgallery/js/lightgallery.min.js"></script>
        <script src="/lib/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/lib/lightgallery/js/lg-pager.min.js"></script>
        <script src="/lib/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/lib/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/lib/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/lib/lightgallery/js/lg-hash.min.js"></script>
        <script src="/lib/lightgallery/js/lg-share.min.js"></script>
        <script src="/lib/lightgallery/js/lg-video.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>