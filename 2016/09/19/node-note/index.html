<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    
    <title>Node 筆記 | DEVLOG of andyyou</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="前言這篇文章試著要整理，翻譯Export This: Interface Design Patterns for Node.js Modules這篇非常值得一讀的文章。但因為這篇文章有些時日了，部分範例已經不符合現況。故這是一篇加上小弟收集彙整而成的更新翻譯。">
<meta name="keywords" content="javascript,nodejs">
<meta property="og:type" content="article">
<meta property="og:title" content="Node 筆記">
<meta property="og:url" content="//andyyou.github.io/2016/09/19/node-note/index.html">
<meta property="og:site_name" content="DEVLOG of andyyou">
<meta property="og:description" content="前言這篇文章試著要整理，翻譯Export This: Interface Design Patterns for Node.js Modules這篇非常值得一讀的文章。但因為這篇文章有些時日了，部分範例已經不符合現況。故這是一篇加上小弟收集彙整而成的更新翻譯。">
<meta property="og:locale" content="zh-TW">
<meta property="og:updated_time" content="2016-12-19T02:32:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node 筆記">
<meta name="twitter:description" content="前言這篇文章試著要整理，翻譯Export This: Interface Design Patterns for Node.js Modules這篇非常值得一讀的文章。但因為這篇文章有些時日了，部分範例已經不符合現況。故這是一篇加上小弟收集彙整而成的更新翻譯。">
    

    

    
        <link rel="icon" href="/images/favicon.png">
    

    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/open-sans/styles.css">
    <link rel="stylesheet" href="/lib/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/lib/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/lib/lightgallery/css/lightgallery.min.css">
    
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-39208536-1', 'auto');
ga('send', 'pageview');

</script>
    
    
    


</head>
</html>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">DEVLOG of andyyou</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466">
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜尋">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: 'Pages',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜尋">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://avatars2.githubusercontent.com/u/665690?v=3&amp;s=466">
            <h2 id="name">andyyou</h2>
            <h3 id="title">Web Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Taipei, Taiwan</span>
            <a id="follow" target="_blank" href="https://github.com/andyyou">關注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                165
                <span>文章</span>
            </div>
            <div class="article-info-block">
                71
                <span>標籤</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/andyyou" target="_blank" title="github" class="tooltip">
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.linkedin.com/pub/zongyan-you/2a/493/16" target="_blank" title="linkedin" class="tooltip">
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-node-note" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Node 筆記
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/09/19/node-note/">
            <time datetime="2016-09-19T04:00:00.000Z" itemprop="datePublished">2016-09-19</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Program/">Program</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/javascript/">javascript</a>, <a class="tag-link" href="/tags/nodejs/">nodejs</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>這篇文章試著要整理，翻譯<a href="http://bites.goodeggs.com/posts/export-this/#global_object" target="_blank" rel="noopener">Export This: Interface Design Patterns for Node.js Modules</a>這篇非常值得一讀的文章。<br>但因為這篇文章有些時日了，部分範例已經不符合現況。故這是一篇加上小弟收集彙整而成的更新翻譯。</p>
<a id="more"></a>
<h1 id="旅程的開始"><a href="#旅程的開始" class="headerlink" title="旅程的開始"></a>旅程的開始</h1><p>當你在 Node 中載入一個模組，我們到底會取回什麼？當我們撰寫一個模組時我們又有哪些選擇可以用來設計程式的介面？<br>在我第一次學習 Node 的時候，發現在 Node 中有太多的方式處理這個問題，由於 Javascript 本身非常彈性，加上在社群中的開發者們各自都有不同的實作風格，這讓當時的我感到有點挫折。</p>
<p>在原文作者的學習旅程中曾持續的觀察尋找好的方式以應用在其的工作上，在這篇文章中將會分享觀察到的 Node 模組設計方式。<br>大略總結了 7 種設計模式(pattern)</p>
<ul>
<li>匯出命名空間 Namespace</li>
<li>匯出函式 Function</li>
<li>匯出高階函式 High-Order Function</li>
<li>匯出建構子/構建函式 Constructor</li>
<li>匯出單一實例物件 Singleton</li>
<li>擴展全域物件 Extend Global Object</li>
<li>套用猴子補丁 Monkey Patch</li>
</ul>
<h1 id="require-exports-和-module-exports"><a href="#require-exports-和-module-exports" class="headerlink" title="require, exports 和 module.exports"></a>require, exports 和 module.exports</h1><p>首先我們需要先聊點基礎的知識</p>
<p>在 Node 官方文件中定義了匯入一個檔案就是匯入一個模組。</p>
<blockquote>
<p>In Node.js, files and modules are in one-to-one correspondence. - Node 文件</p>
</blockquote>
<p>每個模組內都有一個隱式(implicit)的 <code>module</code> 物件，這個物件身上有一個屬性 <code>exports</code> (即 <code>module.exports</code>)。當我們使用 <code>require()</code> 時它所傳回的，即是這個模組的 <code>module.exports</code> 所指向的東西。<br>每個模組的 <code>module.exports</code> 預設都是一個空物件 <code>{}</code>，而每個模組內帶有一個 <code>exports</code> 捷徑變數，預設指向 <code>module.exports</code>。</p>
<p>在<strong>預設</strong>情況下，<code>module.exports</code> 是一個物件，而 <code>exports</code> 又指向該物件，所以在<strong>預設</strong>情況下，以下兩個操作視為等效：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.foo = <span class="string">'hello'</span>;</span><br><span class="line"><span class="comment">// 等同於</span></span><br><span class="line"><span class="built_in">module</span>.exports.foo = <span class="string">'hello'</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果，你重新指定了某東西給 <code>module.exports</code>，當然 <code>module.exports</code> 跟預設物件的關係就因此被打斷，而<strong>此時 <code>exports</code> 捷徑變數仍然是指向預設物件的</strong>。前面有提到，當我們使用 <code>require()</code> 時，模組是以 <code>module.exports</code> 所指向的東西而揭露給外部，因此模組的介面是由 <code>module.exports</code> 所決定，與 <code>exports</code> 捷徑變數無關。<br>因此，一旦 <code>module.exports</code> 被指定新值後，使用捷徑變數 <code>exports</code> 所掛入預設物件的內容都將無法被揭露，因而可視為無效。</p>
<p>為了讓您更好理解關於 <code>exports</code> 與 <code>module.exports</code> 下面的範例提供了較詳細的說明</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">var</span> b = a</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// &#123;id: 1&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// &#123;id: 1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b 參考指向 a，意味著修改 b 的屬性 a 會跟著變動</span></span><br><span class="line">b.id = <span class="number">2</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// &#123;id: 2&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// &#123;id: 2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 但如果將一個全新的物件賦予 b 那麼參考的關係將會中斷</span></span><br><span class="line">b = &#123; <span class="attr">id</span>: <span class="number">3</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// &#123;id: 2&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// &#123;id: 3&#125;</span></span><br></pre></td></tr></table></figure>
<p>另外比較具體的範例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模組預設: module.exports = &#123;&#125;, 而 exports = module.exports, 等同於指向預設的空物件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* person.js */</span></span><br><span class="line">exports.name = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'My name is andyyou.'</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/* main.js */</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="built_in">require</span>(<span class="string">'./person.js'</span>)</span><br><span class="line">person.name()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* person.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">'Hey, andyyou'</span>		<span class="comment">// module.exports 不再是預設物件</span></span><br><span class="line">exports.name = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;        <span class="comment">// 透過 exports 捷徑掛進預設物件的內容, 將無法被揭露</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'My name is andyyou'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* main.js */</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="built_in">require</span>(<span class="string">'./person.js'</span>)</span><br><span class="line"><span class="comment">// exports 的屬性被忽略了</span></span><br><span class="line">person.name() <span class="comment">// TypeError: Object Hey, andyyou has no method 'name'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>exports</code> 只是指向 <code>module.exports</code> 的參考(Reference)</li>
<li><code>module.exports</code> 初始值為 <code>{}</code> 空物件，於是 <code>exports</code> 也會取得該空物件</li>
<li><code>require()</code> 回傳的是 <code>module.exports</code> 而不是 <code>exports</code></li>
<li>所以您可以使用 <code>exports.property_name = something</code> 而不會使用 <code>exports = something</code></li>
<li>一旦使用 <code>exports = something</code> 參考關係便會停止，也就是 <code>exports</code> 的資料都會被忽略。</li>
</ul>
<p>本質上我們可以理解為所有模組都隱含實作了下面這行程式碼　(實際上 <code>module</code> 與 <code>exports</code> 是由 node 模組系統傳入給我們的模組的)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exports = <span class="built_in">module</span>.exports = &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>現在我們知道了，當我們要匯出一個 <code>function</code> 時我們得使用 <code>module.exports</code>。<br>如果令捷徑 <code>exports</code> 變數指向該 <code>function</code>，僅僅是捷徑 <code>exports</code> 對 <code>module.exports</code> 的關係被打斷而已，真正揭露的還是 <code>module.exports</code>。</p>
<p>另外，我們在許多專案看到下面的這行程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exports = <span class="built_in">module</span>.exports = something</span><br></pre></td></tr></table></figure>
<p>這行程式碼作用就是確保 <code>exports</code> 在 <code>module.exports</code> 被我們覆寫之後，仍可以指向相同的參考。</p>
<p>接著我們就可以透過 <code>module.exports</code> 來定義並匯出一個 <code>function</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* function.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">'andyyou'</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的方式則是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> func = <span class="built_in">require</span>(<span class="string">'./function'</span>)</span><br></pre></td></tr></table></figure>
<p>關於 <code>require</code> 一個很重要的行為就是它會快取(Cache) <code>module.exports</code> 的值，未來每一次 require 被調用時都會回傳相同的值。<br>它會根據匯入檔案的<code>絕對路徑</code>來快取，所以當我們想要模組能夠回傳不同得值時，我們就需要匯出 function，如此一來每次執行函式時就會回傳一個新值。</p>
<p>下面在 Node REPL 中簡易的示範</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt; f1 = require(<span class="string">'/Users/andyyou/Projects/export_this/function'</span>)</span><br><span class="line">[Function]</span><br><span class="line">&gt; f2 = require(<span class="string">'./function'</span>) // 相同路徑</span><br><span class="line">[Function]</span><br><span class="line">&gt; f1 === f2</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; f1() === f2()</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>您可以觀察到 <code>require</code> 回傳了同樣的函式物件實例，但每一次調用函式回傳的物件是不同的。<br>更詳細的介紹可以參考<a href="http://nodejs.org/api/modules.html" target="_blank" rel="noopener">官方文件</a>，值得一讀。</p>
<p>現在，我們可以開始探討介面的設計模式(pattern)了。</p>
<h1 id="匯出命名空間"><a href="#匯出命名空間" class="headerlink" title="匯出命名空間"></a>匯出命名空間</h1><p>一個簡單且常用的設計模式就是匯出一個包含數個屬性的物件，這些屬性具體的內容主要是函式，但並不限於函式。<br>如此，我們就能夠透過匯入該模組來取得這個命名空間下一系列相關的功能。</p>
<p>當您匯入一個<code>命名空間</code>類型的模組時，我們通常會將模組指定到某一個變數，然後透過它的成員(物件屬性)來存取使用這些功能。<br>甚至我們也可以將這些變數成員直接指定到區域變數。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> readFile = fs.readFile</span><br><span class="line"><span class="keyword">var</span> ReadStream = fs.ReadStream</span><br><span class="line"></span><br><span class="line">readFile(<span class="string">'./file.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'readFile contents: %s'</span>, data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>這便是<a href="https://github.com/joyent/node/blob/e5346932bcbc523489c9418b82fde31cb666ee99/lib/fs.js#L33" target="_blank" rel="noopener">fs 核心模組</a>的做法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = exports</span><br></pre></td></tr></table></figure>
<p>首先用一個新的區域變數 <code>fs</code>，令其為捷徑 <code>exports</code>，因此預設情況下 <code>fs</code> 就指向了 <code>module.exports</code> 身上的預設物件。上面這一行我們可以說，只是將捷徑變數換個名稱成為 <code>fs</code> 如此而已。<br>接下來，我們就可以使用新的捷徑 <code>fs</code> 了，例如: <code>fs.Stats = binding.Stats</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile = <span class="function"><span class="keyword">function</span> (<span class="params">path, options, callback_</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他東西也是一樣的作法，例如匯出建構子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.ReadStream = ReadStream</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ReadStream</span>(<span class="params">path, options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">ReadStream.prototype.open = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>當匯出命名空間時，您可以指定屬性到 <code>exports</code> ，就像 <code>fs</code> 的作法，又或者可以建立一個新的物件指派給 <code>module.exports</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* exports 作法 */</span></span><br><span class="line">exports.verstion = <span class="string">'1.0'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 或者 module.exports 作法 */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  version: <span class="string">'1.0'</span>,</span><br><span class="line">  doYourTasks: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一個常見的作法就是透過一個根模組(root)來彙整並匯出其他模組，如此一來只需要一個 require 便可以使用所有的模組。<br>原文作者在<a href="https://www.goodeggs.com/sfbay/home" target="_blank" rel="noopener">Good Eggs</a>工作時，會將資料模型(Model)拆分成個別的模組，並使用<code>匯出建構子</code>的方式匯出(請參考下文介紹)，然後透過一個 <code>index 檔案</code> 來集合該目錄下所有的資料模型並一起匯出，如此一來在 <code>models</code> 命名空間下的所有資料模型都可以使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> models = <span class="built_in">require</span>(<span class="string">'./models'</span>)</span><br><span class="line"><span class="keyword">var</span> User = models.User</span><br><span class="line"><span class="keyword">var</span> Product = models.Product</span><br></pre></td></tr></table></figure>
<p>在 ES2015 和 CoffeeScript 中我們甚至還可以使用解構指派來匯入我們需要的功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* CoffeeScript */</span></span><br><span class="line">&#123;User, Product&#125; = <span class="built_in">require</span> <span class="string">'./models'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ES2015 */</span></span><br><span class="line"><span class="keyword">import</span> &#123;User, Product&#125; <span class="keyword">from</span> <span class="string">'./models'</span></span><br></pre></td></tr></table></figure>
<p>而剛剛提到的 <code>index.js</code> 大概就如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exports.User = <span class="built_in">require</span>(<span class="string">'./User'</span>)</span><br><span class="line">exports.Person = <span class="built_in">require</span>(<span class="string">'./person'</span>)</span><br></pre></td></tr></table></figure>
<p>實際上這樣分開的寫法還有更精簡的寫法，我們可以透過一個小小的函式庫來匯入在同一階層中所有檔案並搭配 CamelCase 的命名規則匯出。<br>於是在我們的 index.js 中看起來就會如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'../lib/require_siblings'</span>)(__filename)</span><br></pre></td></tr></table></figure>
<h1 id="匯出函式"><a href="#匯出函式" class="headerlink" title="匯出函式"></a>匯出函式</h1><p>另外一個設計模式是匯出函式當作該模組的介面。常見的作法是匯出一個工廠函式(Factory function)，然後呼叫並回傳一個物件。<br>在使用 Express.js 的時候便是這種作法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()	<span class="comment">// 實際上 express() 傳回的 app 是一個 function，在 JS 中函式也是物件</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/hello'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'Hi there! We are using Express v'</span> + express.version)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Express 匯出該函式，讓我們可以用來建立一個新的 express 應用程式。<br>在使用這種模式時，通常我們會使用 factory function 搭配參數讓我們可以設定並回傳初始化後的物件。</p>
<p>想要匯出 function，我們就一定要使用 <code>module.exports</code> ，<code>Express</code> 便是這麼做</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exports = <span class="built_in">module</span>.exports = createApplication</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createApplication</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面指派了 <code>createApplication</code> 函式到 <code>module.exports</code> 然後再指給 <code>exports</code> 確保參考一致。<br>同時 Express 也使用下面這種方式將導出函式當作<code>命名空間的作法</code>使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exports.version = <span class="string">'3.1.1'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>這邊要大略解釋一下由於 Javascript 原生並沒有支援命名空間的機制，於是大部分在 JS 中提到的 namespace 指的就是透過物件封裝的方式來達到 namespace 的效果，也就是第一種設計模式。</p>
</blockquote>
<p>注意！並沒有任何方式可以阻止我們將匯出的函式作為<code>命名空間物件</code>使用，我們可以用其來引用其他的 function，建構子，物件。</p>
<blockquote>
<p>Express 3.3.2 / 2013-07-03 之後已經將 exports.version 移除了</p>
</blockquote>
<p>另外在匯出函式的時候最好為其命名，如此一來當出錯的時候我們比較容易從錯誤堆疊資訊中找到問題點。</p>
<p>下面是兩個簡單的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* bomb1.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'boom'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">bomb</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'boom'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt; bomb = require(<span class="string">'./bomb1'</span>);</span><br><span class="line">[Function]</span><br><span class="line">&gt; bomb()</span><br><span class="line">Error: boom</span><br><span class="line">    at module.exports (/Users/andyyou/Projects/export_this/bomb1.js:2:9)</span><br><span class="line">    at repl:1:2</span><br><span class="line">    ...</span><br><span class="line">&gt; bomb = require(<span class="string">'./bomb2'</span>);</span><br><span class="line">[Function: bomb]</span><br><span class="line">&gt; bomb()</span><br><span class="line">Error: boom</span><br><span class="line">    at bomb (/Users/andyyou/Projects/export_this/bomb2.js:2:9)</span><br><span class="line">    at repl:1:2</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>匯出函式還有些比較特別的案例，值得用另外的名稱以區分它們的不同。</p>
<h1 id="匯出高階函式"><a href="#匯出高階函式" class="headerlink" title="匯出高階函式"></a>匯出高階函式</h1><p>一個高階函式或 functor 基本上就是一個函式可以接受一個或多個函式為其輸入或輸出。而這邊我們要談論的後者 - <code>一個函式回傳函式</code><br>當我們想要模組能夠根據輸入控制回傳函式的行為時，匯出一個高階函式就是一種非常實用的設計模式。</p>
<blockquote>
<p>補充：<a href="http://www.jdon.com/idea/functor-monad.html" target="_blank" rel="noopener">functor &amp; monad</a></p>
</blockquote>
<p>舉例來說 <a href="http://www.senchalabs.org/connect/" target="_blank" rel="noopener">Connect</a> 就提供了許多可掛載的功能給網頁框架。<br>這裡的 middleware 我們先理解成一個有三個參數 <code>(req, res, next)</code> 的 function。</p>
<blockquote>
<p>Express 從 v4.x 版之後不再相依於 connect</p>
</blockquote>
<p><code>connect middleware</code> 慣例就是匯出的 function 執行後，要回傳一個 <code>middleware function</code>。<br>在處理 request 的過程中這個回傳的 <code>middleware function</code> 就可以接手使用剛剛提到的三個參數，用來在過程中做一些處理或設定。<br>同時因為閉包的特性這些設定在整個中介軟體的處理流程中都是有效的。</p>
<p>舉例來說，<code>compression</code> 這個 middleware 就可以在處理 responsive 過程中協助壓縮</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>)</span><br><span class="line"><span class="keyword">var</span> app = connect()</span><br><span class="line"></span><br><span class="line"><span class="comment">// gzip outgoing responses</span></span><br><span class="line"><span class="keyword">var</span> compression = <span class="built_in">require</span>(<span class="string">'compression'</span>)</span><br><span class="line">app.use(compression())</span><br></pre></td></tr></table></figure>
<p>而它的原始碼看起來就如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = compression</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compression</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">compression</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>於是每一個 request 都會經過 compression middleware 處理，而代入的 options 也因為閉包的關係會被保留下來</p>
<p>這是一種極具彈性的模組作法，也可能在您的開發項目上幫上許多忙。</p>
<blockquote>
<p>middleware 在這裡您可以大略想成串連執行一系列的 function，自然其 Function Signature 要一致</p>
</blockquote>
<h1 id="匯出建構子"><a href="#匯出建構子" class="headerlink" title="匯出建構子"></a>匯出建構子</h1><p>在一般物件導向語言中，constructor 建構子指的是協助我們從<code>類別 Class</code>建立一個該類別物件實例的一段程式碼。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C#</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Car</span> &#123;</span><br><span class="line">  <span class="comment">// c# 建構子</span></span><br><span class="line">  <span class="comment">// constructor 即 class 中用來初始化物件的 method。</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Car</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> Car(<span class="string">'BMW'</span>);</span><br></pre></td></tr></table></figure>
<p>由於在 ES2015 之前 Javascript 並不支援類別，某種程度上在 Javascript 之中我們可以把任何一個 function 當作類別，或者說一個 function 可以當作 function 執行或者搭配 <code>new</code> 關鍵字當作 constructor 來使用。如果想知道更詳細的介紹可以閱讀<a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript" target="_blank" rel="noopener">MDN 教學</a>。</p>
<p>欲匯出建構子，我們需要透過構造函式來定義類別，然後透過 <code>new</code> 來建立物件實例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hi, I am '</span> + <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">'andyyou'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person.greet()) <span class="comment">// Hi, I am andyyou</span></span><br></pre></td></tr></table></figure>
<p>在這種設計模式底下，我們通常會將每個檔案設計成一個類別，然後匯出建構子。這使得我們的專案架構更加清楚。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="built_in">require</span>(<span class="string">'./person'</span>)</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure>
<p>整個檔案看起來會如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* person.js */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hi, I am '</span> + <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports = <span class="built_in">module</span>.exports = Person</span><br></pre></td></tr></table></figure>
<h1 id="匯出單一物件實例-Signleton"><a href="#匯出單一物件實例-Signleton" class="headerlink" title="匯出單一物件實例 Signleton"></a>匯出單一物件實例 <a href="http://openhome.cc/Gossip/DesignPattern/SingletonPattern.htm" target="_blank" rel="noopener">Signleton</a></h1><p>當我們需要所有的模組使用者共享物件的狀態與行為時，就需要匯出單一物件實例。</p>
<p><a href="http://mongoosejs.com/" target="_blank" rel="noopener">Mongoose</a>是一個 ODM(Object-Document Mapper)函式庫，讓我們可以使用程式中的 Model 物件去操作 MongoDB。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost/test'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Cat = mongoose.model(<span class="string">'Cat'</span>, &#123;<span class="attr">name</span>: <span class="built_in">String</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> kitty = <span class="keyword">new</span> Cat(&#123;<span class="attr">name</span>: <span class="string">'Zildjian'</span>&#125;)</span><br><span class="line">kitty.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err)</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'save failed'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'meow'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>那我們 require 取得的 <code>mongoose</code> 物件是什麼東西呢？事實上 <code>mongoose</code> 模組的內部是這麼處理的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Mongoose</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = exports = <span class="keyword">new</span> Mongoose()</span><br></pre></td></tr></table></figure>
<p>因為 <code>require</code> 的快取了 <code>module.exports</code> 的值，於是所有 <code>reqire(&#39;mongoose&#39;)</code> 將會回傳相同的物件實例，之後在整個應用程式之中使用的都會是同一個物件。</p>
<p>Mongoose 使用物件導向的設計模式來封裝，解耦(分離功能之間的相依性)，維護狀態使整體具備可讀性，同時透過匯出一個 Mongoose Class 的物件給使用者，讓我們可以簡單的存取使用。</p>
<p>如果我們有需要，它也可以建立其他的物件實例來作為命名空間使用。實際上 Mongoose 內部提供了存取建構子的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mongoose.prototype.Mongoose = Mongoose</span><br></pre></td></tr></table></figure>
<p>因此我們可以這麼做</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">var</span> Mongoose = mongoose.Mongoose</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> anotherMongoose = <span class="keyword">new</span> Mongoose()</span><br><span class="line">anotherMongoose.connect(<span class="string">'mongodb://localhost/test'</span>)</span><br></pre></td></tr></table></figure>
<h1 id="擴展全域物件"><a href="#擴展全域物件" class="headerlink" title="擴展全域物件"></a>擴展全域物件</h1><p>一個被匯入的模組不只限於單純取得其匯出的資料。它也可以用來修改全域物件或回傳全域物件，自然也能定義新的全域物件。而在這邊的全域物件(Global objects)或稱為標準內建物件像是 <code>Object</code>, <code>Function</code>, <code>Array</code> 指的是在全域能存取到的物件們，而不是當 Javascript 開始執行時所產生代表 global scope 的 global object。</p>
<p>當我們需要擴增或修改全域物件預設行為時就需要使用這種設計模式。當然這樣的方式是有爭議，您必須謹慎使用，特別是在開放原始碼的專案上。</p>
<p>例如：<a href="https://github.com/visionmedia/should.js" target="_blank" rel="noopener">Should.js</a>是一個常被用在單元測試中用來判斷分析 <code>值</code> 是否正確的函式庫。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'should'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">  name: <span class="string">'andyyou'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user.name.should.equal(<span class="string">'andyyou'</span>)</span><br></pre></td></tr></table></figure>
<p>這樣您是否比較清楚了，<code>should.js</code> 增加了底層的 <code>Object</code> 的功能，<a href="https://github.com/visionmedia/should.js/blob/68000f47d01408cacb80441a1d9bf10ba423e54c/lib/should.js#L107-L113" target="_blank" rel="noopener">加入了一個非列舉型的屬性</a> <code>should</code> ，讓我們可以用簡潔的語法來撰寫單元測試。</p>
<p>而在內部 <code>should.js</code> 做了這樣的事情</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> should = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Assertion(util.isWrapperType(obj) ? obj.valueOf(): obj)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">exports = <span class="built_in">module</span>.exports = should</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Object</span>.prototype, <span class="string">'should'</span>, &#123;</span><br><span class="line">  set: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> should(<span class="keyword">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  configurable: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>就算看到這邊您肯定跟我一樣有滿滿的疑惑，全域物件擴展定義跟 exports 有啥關聯呢？</p>
<p>事實上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* whoami.js */</span></span><br><span class="line">exports = <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  name: <span class="string">'andyyou'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Object</span>.prototype, <span class="string">'whoami'</span>, &#123;</span><br><span class="line">  set: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'I am '</span> + <span class="keyword">this</span>.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* app.js */</span></span><br><span class="line"><span class="keyword">var</span> whoami = <span class="built_in">require</span>(<span class="string">'whoami'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(whoami) <span class="comment">// &#123; name: 'andyyou' &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">'lena'</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.whoami) <span class="comment">// I am lena</span></span><br></pre></td></tr></table></figure>
<p>現在我們明白了上面說的<code>修改全域物件</code>的意思了。<code>should.js</code> 匯出了一個 <code>should</code> 函式但是它主要的使用方式則是把 should 加到 Object 屬性上，透過物件本身來呼叫。</p>
<h1 id="套用猴子補丁-Monkey-Patch"><a href="#套用猴子補丁-Monkey-Patch" class="headerlink" title="套用猴子補丁(Monkey Patch)"></a>套用猴子補丁(Monkey Patch)</h1><p>在這邊所謂的猴子補丁特別指的是在執行時期動態修改一個類別、模組或物件(也稱 object augmentation)，通常會這麼做是希望補強某的第三方套件的 bug 或功能。</p>
<p>假設某個模組沒有提供您客製化功能的介面，而您又需要這個功能的時候，我們就會實作一個模組來補強既有的模組。<br>這個設計模式有點類似<code>擴展全域物件</code>，但並非修改全域物件，而是依靠 Node 模組系統的快取機制，當其他程式碼匯入該模組時去補強該模組的實例物件。</p>
<p>預設來說 Mongoose 會使用小寫以及複數的慣例替資料模型命名。例如一個資料模型叫做 <code>CreditCard</code> 最終我們會得到 collection 的名稱是 <code>creditcards</code> 。假如我們希望可以換成 <code>credit_cards</code> 並且其他地方也遵循一樣的用法。</p>
<p>下面是我們試著使用猴子補丁的方式來替既有的模組增加功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pluralize = <span class="built_in">require</span>(<span class="string">'pluralize'</span>) <span class="comment">// 處理複數單字的函式庫</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">var</span> Mongoose = mongoose.Mongoose</span><br><span class="line"></span><br><span class="line">mongoose.Promise = global.Promise <span class="comment">// v4.1+ http://mongoosejs.com/docs/promises.html</span></span><br><span class="line"><span class="keyword">var</span> model = Mongoose.prototype.model</span><br><span class="line"></span><br><span class="line"><span class="comment">// 補丁</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params">name, schema, collection, skipInit</span>) </span>&#123;</span><br><span class="line">  collection = collection || pluralize.plural(name.replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">'$1_$2'</span>).toLowerCase())</span><br><span class="line">  <span class="keyword">return</span> model.call(<span class="keyword">this</span>, name, schema, collection, skipInit)</span><br><span class="line">&#125;</span><br><span class="line">Mongoose.prototype.model = fn</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 實際測試 */</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost/test'</span>)</span><br><span class="line"><span class="keyword">var</span> CreditCardSchema = <span class="keyword">new</span> mongoose.Schema(&#123;<span class="attr">number</span>: <span class="built_in">String</span>&#125;)</span><br><span class="line"><span class="keyword">var</span> CreditCardModel = mongoose.model(<span class="string">'CreditCard'</span>, CreditCardSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> card = <span class="keyword">new</span> CreditCardModel(&#123;<span class="attr">number</span>: <span class="string">'5555444433332222'</span>&#125;);</span><br><span class="line">card.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您不該輕易使用上面這種方式補丁，這邊只是為了說明猴子補丁這種方式，mongoose 已經有提供官方的方式設定名稱</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">collection</span>: <span class="string">'your_collection_name'</span> &#125;)</span><br></pre></td></tr></table></figure>
<p>當這個模組第一次被匯入的時候便會讓 <code>mongoose</code> 重新定義 <code>Mongoose.prototype.model</code> 並將其設回原本的 model 的實作。<br>如此一來所有 <code>Mongoose</code> 的實例物件都具備新的行為了。注意到這邊並沒有修改 <code>exports</code> 所以當我們 require 的時候得到的是預設的物件</p>
<p>另外如果您想使用上面這種補丁的方式時，記得閱讀原始碼並注意是否產生衝突。</p>
<h1 id="請善用匯出的功能"><a href="#請善用匯出的功能" class="headerlink" title="請善用匯出的功能"></a>請善用匯出的功能</h1><p>Node模組系統提供了一個簡單的機制來封裝功能，使我們能夠建立了清楚的介面。希望掌握這七種設計模式提供不同的優缺點能對您有所幫助。</p>
<p>在這邊作者並沒有徹底的調查所有的方式，一定有其他選項可供選擇，這邊只有描述幾個最常見且不錯的方法。</p>
<h1 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h1><ul>
<li>namespace: 匯出一個物件包含需要的功能<ul>
<li>root module 的方式，使用一個根模組匯出其他模組</li>
</ul>
</li>
<li>function: 直接將 <code>module.exports</code> 設為 function<ul>
<li>Function 物件也可以拿來當作命名空間使用</li>
<li>為其命名方便偵錯</li>
<li><code>exports = module.exports = something</code> 的作法是為了確保參考(Reference)一致</li>
</ul>
</li>
<li>high-order function: 可以透過代入參數控制並回傳 function 。<ul>
<li>可協助實作 middleware 的設計模式</li>
<li>換句話說 middleware 即一系列相同 <a href="https://developer.mozilla.org/zh-TW/docs/Glossary/Signature/Function" target="_blank" rel="noopener">signature</a> 的 function 串連。一個接一個執行</li>
</ul>
</li>
<li>constructor: 匯出類別(function)，使用時再 <code>new</code>，具備 OOP 的優點</li>
<li>singleton: 匯出單一物件實例，重點在各個檔案可以共享物件狀態</li>
<li>global objects: 在全域物件作的修改也會一起被匯出</li>
<li>monkey patch: 執行時期，利用 Node 快取機制在 instance 加上補丁</li>
</ul>
<h1 id="筆記"><a href="#筆記" class="headerlink" title="筆記"></a>筆記</h1><ul>
<li>一個 javascript 檔案可視為一個模組</li>
<li>解決特定問題或需求，功能完整由單一或多個模組組合而成的整體稱為套件(package)</li>
<li><code>require</code> 匯入的模組具有自己的 <code>scope</code></li>
<li><code>exports</code> 只是 <code>module.exports</code> 的參考，<code>exports</code> 會記錄收集屬性如果 <code>module.exports</code> 沒有任何屬性就把其資料交給 <code>module.exports</code> ，但如果 <code>module.exports</code> 已經具備屬性的話，那麼<code>exports</code> 的所有資料都會被忽略。</li>
<li>就算 <code>exports</code> 置於後方仍會被忽略</li>
<li>Node 初始化的順序<ul>
<li>Native Module -&gt; Module</li>
<li>StartNodeInstance() -&gt; CreateEnvironment() -&gt; LoadEnvironment() -&gt; Cached</li>
</ul>
</li>
<li>Native Module 載入機制<ul>
<li>檢查是否有快取</li>
<li>-&gt; 有; 直接回傳 <code>this.exports</code></li>
<li>-&gt; 沒有; new 一個模組物件</li>
<li>cache()</li>
<li>compile() -&gt; NativeModule.wrap() 將原始碼包進 <code>function</code> 字串 -&gt; <code>runInThisContext()</code> 建立函式</li>
<li>return NativeModule.exports</li>
</ul>
</li>
<li>Node 的 require 會 cache ，也就是說：如果希望模組產生不同的 instance 時應使用 function</li>
</ul>
<h1 id="資源"><a href="#資源" class="headerlink" title="資源"></a>資源</h1><ul>
<li><a href="https://nodejs.org/api/modules.html" target="_blank" rel="noopener">官方 module 文件</a></li>
<li><a href="https://www.sitepoint.com/understanding-module-exports-exports-node-js/" target="_blank" rel="noopener">理解 module exports</a></li>
<li><a href="http://bites.goodeggs.com/posts/export-this/" target="_blank" rel="noopener">Export This: Interface Design Patterns for Node.js Modules</a></li>
<li><a href="http://weizhifeng.net/node-js-exports-vs-module-exports.html" target="_blank" rel="noopener">module.exports v.s exports</a></li>
<li><a href="http://simeneer.blogspot.tw/2016/09/node-i-module.html" target="_blank" rel="noopener">從 node.js 原始碼看 exports 與 module.exports</a></li>
<li><a href="https://987.tw/2014/03/08/export-this-node-jsmo-zu-de-jie-mian-she-ji-mo-shi/" target="_blank" rel="noopener">Export This 中文</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="//andyyou.github.io/2016/09/19/node-note/" data-id="cjo2rvmo000l61bms07d99aip" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2016/09/22/js-contrstructors-prototypes-new/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    筆記 Javascript 的 constructors, prototypes, new 關鍵字
                
            </div>
        </a>
    
    
        <a href="/2016/08/26/facebook-bot/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Facebook Bot 開發小技巧</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">分類</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Cloud/">Cloud</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Fun/">Fun</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Program/">Program</a><span class="category-list-count">120</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/">System</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">17</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">歸檔</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">一月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">十一月 2011</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">標籤</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net-mvc/">.net mvc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RoR/">RoR</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">aws</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/">azure</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bot/">bot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bundler/">bundler</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cache/">cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/carrier-wave/">carrier wave</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudflare/">cloudflare</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compass/">compass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devise/">devise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/e-invoice/">e-invoice</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/entity-framework/">entity framework</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facebook/">facebook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flux/">flux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/framework/">framework</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iisexpress/">iisexpress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/">ios</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">64</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript-express-passport/">javascript express passport</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript-nodejs/">javascript nodejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jspm/">jspm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/">jwt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mechanism/">mechanism</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oocss/">oocss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/osx/">osx</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/package-manager/">package manager</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgres/">postgres</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/">postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/queue/">queue</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitmq/">rabbitmq</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rack-server/">rack server</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/">rails</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails-webpack-stimulus-javascript-bootstrap/">rails webpack stimulus javascript bootstrap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry-pi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-native/">react native</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reactjs/">reactjs</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redux/">redux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sass/">sass</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/">selenium</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slim/">slim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stimulus/">stimulus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg-javascript/">svg javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task-runner/">task runner</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/">xml</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">標籤雲</h3>
        <div class="widget tagcloud">
            <a href="/tags/net-mvc/" style="font-size: 10px;">.net mvc</a> <a href="/tags/RoR/" style="font-size: 17px;">RoR</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/aws/" style="font-size: 10px;">aws</a> <a href="/tags/azure/" style="font-size: 11px;">azure</a> <a href="/tags/bot/" style="font-size: 10px;">bot</a> <a href="/tags/bundler/" style="font-size: 11px;">bundler</a> <a href="/tags/cache/" style="font-size: 10px;">cache</a> <a href="/tags/carrier-wave/" style="font-size: 11px;">carrier wave</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/cloudflare/" style="font-size: 10px;">cloudflare</a> <a href="/tags/compass/" style="font-size: 10px;">compass</a> <a href="/tags/css/" style="font-size: 18px;">css</a> <a href="/tags/devise/" style="font-size: 10px;">devise</a> <a href="/tags/docker/" style="font-size: 11px;">docker</a> <a href="/tags/e-invoice/" style="font-size: 10px;">e-invoice</a> <a href="/tags/entity-framework/" style="font-size: 10px;">entity framework</a> <a href="/tags/es6/" style="font-size: 12px;">es6</a> <a href="/tags/facebook/" style="font-size: 10px;">facebook</a> <a href="/tags/flux/" style="font-size: 10px;">flux</a> <a href="/tags/framework/" style="font-size: 11px;">framework</a> <a href="/tags/grunt/" style="font-size: 13px;">grunt</a> <a href="/tags/gulp/" style="font-size: 12px;">gulp</a> <a href="/tags/heroku/" style="font-size: 14px;">heroku</a> <a href="/tags/html/" style="font-size: 11px;">html</a> <a href="/tags/iisexpress/" style="font-size: 10px;">iisexpress</a> <a href="/tags/ios/" style="font-size: 12px;">ios</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/javascript-express-passport/" style="font-size: 10px;">javascript express passport</a> <a href="/tags/javascript-nodejs/" style="font-size: 10px;">javascript nodejs</a> <a href="/tags/jekyll/" style="font-size: 11px;">jekyll</a> <a href="/tags/jspm/" style="font-size: 10px;">jspm</a> <a href="/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mechanism/" style="font-size: 10px;">mechanism</a> <a href="/tags/mongodb/" style="font-size: 11px;">mongodb</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/nodejs/" style="font-size: 16px;">nodejs</a> <a href="/tags/oocss/" style="font-size: 10px;">oocss</a> <a href="/tags/osx/" style="font-size: 15px;">osx</a> <a href="/tags/package-manager/" style="font-size: 15px;">package manager</a> <a href="/tags/php/" style="font-size: 11px;">php</a> <a href="/tags/postgres/" style="font-size: 10px;">postgres</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql</a> <a href="/tags/queue/" style="font-size: 11px;">queue</a> <a href="/tags/rabbitmq/" style="font-size: 11px;">rabbitmq</a> <a href="/tags/rack-server/" style="font-size: 10px;">rack server</a> <a href="/tags/rails/" style="font-size: 12px;">rails</a> <a href="/tags/rails-webpack-stimulus-javascript-bootstrap/" style="font-size: 10px;">rails webpack stimulus javascript bootstrap</a> <a href="/tags/raspberry-pi/" style="font-size: 10px;">raspberry-pi</a> <a href="/tags/react-native/" style="font-size: 10px;">react native</a> <a href="/tags/reactjs/" style="font-size: 19px;">reactjs</a> <a href="/tags/redux/" style="font-size: 10px;">redux</a> <a href="/tags/ruby/" style="font-size: 17px;">ruby</a> <a href="/tags/sass/" style="font-size: 11px;">sass</a> <a href="/tags/selenium/" style="font-size: 10px;">selenium</a> <a href="/tags/slim/" style="font-size: 10px;">slim</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/stimulus/" style="font-size: 10px;">stimulus</a> <a href="/tags/svg-javascript/" style="font-size: 12px;">svg javascript</a> <a href="/tags/task-runner/" style="font-size: 12px;">task runner</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/ubuntu/" style="font-size: 11px;">ubuntu</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/vuejs/" style="font-size: 14px;">vuejs</a> <a href="/tags/webpack/" style="font-size: 13px;">webpack</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 andyyou(You,ZongYan)
        </div>
    </div>
</footer>

        

    
        <script src="/lib/lightgallery/js/lightgallery.min.js"></script>
        <script src="/lib/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/lib/lightgallery/js/lg-pager.min.js"></script>
        <script src="/lib/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/lib/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/lib/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/lib/lightgallery/js/lg-hash.min.js"></script>
        <script src="/lib/lightgallery/js/lg-share.min.js"></script>
        <script src="/lib/lightgallery/js/lg-video.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>